from flask import Flask, request, render_template
import hashlib
import json

app = Flask(__name__)

@app.route('/')
def home():
    return render_template('login.html')

@app.route('/login', methods=['POST'])
def login():
    # Parse form data from the request
    name = request.form.get('name')
    password = request.form.get('password')

    # Validate inputs
    if not name:
        return "name is required", 400

    users = open("user_hashes.txt")

    final_hash = None

    for user_hash in users.lines():
        h = hashlib.new('md5')
        h.update(name.encode())
        if h.hexdigest() == user_hash:
            final_hash = user_hash
            break

    if not final_hash:
        return "No such registered name", 401

    passwords = open("password_hashes.json")
    passwords = json.load(passwords)

    h = hashlib.new('md5')
    h.update(password.encode())
    if h.hexdigest() != passwords:
        return "Wrong password", 401
        

    return "Found flag", 200

if __name__ == '__main__':
    app.run(debug=True)

